<!DOCTYPE html>
<!--
La estructura del programa debe incluir:
Un componente del cuadrado que puedes mover para jugar (0.5)
Un componente de la puntuación (1)
Una función que define el área de bloques donde se puede matar al jugador (incluye la creación de espacios aleatorios al principio y después de x milisegundos) (2)
Una función que evalúa si ha habido contacto entre los bloques y la casilla del jugador (2)
Una función que actualiza la posición del cuadrado de acuerdo con su posición anterior, su velocidad y su aceleración (1)
Una función que comprueba si hemos llegado a la parte inferior o superior del lienzo (0.5)
-----EXTRA------
Puede agregar 4 direcciones en lugar de solo dos (4 controles de teclado, superior, derecha, izquierda e inferior) (1)
Puedes elegir cómo ganar vida o cómo terminar el juego de forma progresiva (1)
Puedes agregar otro jugador que se mueva de manera diferente al primero (1)
-->
<html lang="en">
<!--Programar game over JS-- VIDEO -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
</head>
<!-- Info para crear juegos -->
<!--https://juegoscanvas.blogspot.com/-->
<!--https://developer.mozilla.org/es/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript/Paddle_and_keyboard_controls-->

<!--No funciona como deberia le doy a la izquierda y solo va hacia esa dirección-->

<!--juego del ping pong-->
<!--https://developer.mozilla.org/es/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript-->

<body>
    <div class="contenedor">

        <div id="menu">
            <h4>Elija los jugadores</h4>
            <p class="j1">1 jugador</p>
            <input id="input1" type="checkbox" onclick="input1()" name="jugadores">
            <p class="j2">2 jugador</p>
            <input id="input2" type="checkbox" onclick="input2()" name="jugadores">
            <button onclick="crear()">START</button>
        </div>

    </div>
    <canvas id="canvas" width="540" height="400" style="display: none;"></canvas>
    <script>
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");

        // Variables jugadores
        var jugador2 = false;

        //Variables X e Y desde donde sale la bola
        var x = canvas.width / 2;
        var y = canvas.height - 120;
        var x2 = canvas.width / 4;
        var y2 = canvas.height - 120;
        //Variables para la velocidad por las cordenadas X e Y
        var dx = 3;
        var dy = -4;

        var dx2 = 3;
        var dy2 = -4;

        //Radio de la pelota
        var radioBall = 10;

        //Tamaño del rectangulo
        var rectAlto = 10;
        var rectAncho = 75;

        //Posicion por el eje X
        var rectX = (canvas.width - rectAncho) / 2;
        var rectX2 = (canvas.width - rectAncho) / 4;

        //Teclas
        var der = false;
        var izq = false;

        var der2 = false;
        var izq2 = false;

        //Ladrillo
        var ladrilloAncho = 75;
        var ladrilloAltura = 20;

        //Propiedades bloque de ladrillos 
        var ladrilloFilas = 4;
        var ladrilloColumnas = 6;
        var ladrilloPadding = 5;
        var entreLadrillosTop = 30;
        var entreLadrillosIzq = 50;

        //Obstaculo ******** SIN UTILIZAR **************
        var obstaculoAncho = 60;
        var obstaculoAltura = 10;

        //Puntuacion
        var puntuacion = 0;
        var puntuacion2=0;
        //vidas
        var vidas = 3;
        var vidas2 = 3;

        function input1() {
            jugador2 = false;
            document.getElementById("canvas").setAttribute("width", "540");
            document.getElementById("canvas").setAttribute("height", "400");
            ladrilloFilas = 4;
            ladrilloColumnas = 6;
            rectAlto = 10;
            rectAncho = 75;
            radioBall = 10;
            ladrilloAncho = 75;
            ladrilloAltura = 20;
            rellenarLadrillos();
        }

        function input2() {
            jugador2 = true;
            document.getElementById("canvas").setAttribute("width", "1490");
            document.getElementById("canvas").setAttribute("height", "900");
            ladrilloFilas = 6;
            ladrilloColumnas = 10;
            rectAlto = 15;
            rectAncho = 115;
            radioBall = 15;
            ladrilloAncho = 115;
            ladrilloAltura = 25;
            entreLadrillosIzq = 150;
            rellenarLadrillos();
        }

        var ladrillos = [];

        function rellenarLadrillos() {
            for (col = 0; col < ladrilloColumnas; col++) {
                ladrillos[col] = [];
                for (fila = 0; fila < ladrilloFilas; fila++) {
                    ladrillos[col][fila] = {
                        x: 0,
                        y: 0,
                        status: 1
                    };
                }
            }
        }

        //Estos dos event listener cogeran cuando presione o no presione las teclas
        document.addEventListener("keyup", SinPresionar, false);
        document.addEventListener("keydown", Presionada, false);

        function SinPresionar(tecla) {
            if (tecla.keyCode == 39) {
                der = false;
            } else if (tecla.keyCode == 37) {
                izq = false;
            }
            if (tecla.keyCode == 68) {
                der2 = false;
            } else if (tecla.keyCode == 65) {
                izq2 = false;
            }
        }


        function Presionada(tecla) {
            if (tecla.keyCode == 39) {
                der = true;
            } else if (tecla.keyCode == 37) {
                izq = true;
            }
            if (tecla.keyCode == 68) {
                der2 = true;
            } else if (tecla.keyCode == 65) {
                izq2 = true;
            }
        }


        //funcion que nos dibuja las vidas
        function dibujVidas() {
            context.font = "16px Arial";
            context.fillStyle = "red";
            context.fillText("J1 Vidas: " + vidas, canvas.width - 85, 20);
        }

        function dibujVidas2() {
            context.font = "16px Arial";
            context.fillStyle = "red";
            context.fillText("J2 Vidas: " + vidas2, canvas.width - 85, 40);
        }

        //funcion que nos dibuja la puntuacion
        function crearPuntuacion() {

            context.font = " 18px Arial";
            context.fillStyle = "black";
            context.fillText("J1 Puntuacion: " + puntuacion, 8, 20);
        }

        function crearPuntuacion2() {

            context.font = " 18px Arial";
            context.fillStyle = "black";
            context.fillText("J2 Puntuacion: " + puntuacion2, 8, 40);
        }

        //funcion la cual detecta la colision de la pelota contra el ladrillo
        function deteccionColisiones() {

            for (col = 0; col < ladrilloColumnas; col++) {
                for (fila = 0; fila < ladrilloFilas; fila++) {
                    var l = ladrillos[col][fila];
                    if (l.status == 1) {
                        if (x + radioBall > l.x && x < l.x + ladrilloAncho && y - radioBall > l.y && y < l.y +
                            ladrilloAltura) {
                            dy = -dy;
                            l.status = 0;
                            puntuacion++;
                            if (puntuacion == ladrilloColumnas * ladrilloFilas) {
                                alert("Has ganado ENHORABUENA!!!!");
                                document.getElementById("menu").style.display = ""
                                document.getElementById("canvas").style.display = "none";

                                x = canvas.width / 3;
                                y = canvas.height - 50;
                                dx = 3;
                                dy = -4;
                                rectX = (canvas.width - rectAncho) / 2;

                                if (der && rectX < canvas.width - rectAncho) {
                                    rectX += 8;
                                } else if (izq && rectX > 0) {
                                    rectX -= 8;
                                }

                                if (der2 && rectX2 < canvas.width - rectAncho) {
                                    rectX2 += 8;
                                } else if (izq2 && rectX2 > 0) {
                                    rectX2 -= 8;
                                }

                                document.location.reload();

                            }
                        }
                    }
                }

            }

        }

        function deteccionColisiones2() {

            for (col = 0; col < ladrilloColumnas; col++) {
                for (fila = 0; fila < ladrilloFilas; fila++) {
                    var l = ladrillos[col][fila];
                    if (l.status == 1) {
                        if (x2 >= l.x2 && x2 <= l.x2 + ladrilloAncho && y2 >= l.y2 && y2 <= l.y2 + ladrilloAltura) {
                            dy2 = -dy2;
                            l.status = 0;
                            puntuacion++;
                            if (puntuacion == ladrilloColumnas * ladrilloFilas) {
                                alert("Has ganado ENHORABUENA!!!!");
                                document.getElementById("menu").style.display = ""
                                document.getElementById("canvas").style.display = "none";

                                x2 = canvas.width / 3;
                                y2 = canvas.height - 50;
                                dx2 = 3;
                                dy2 = -4;
                                rectX2 = (canvas.width - rectAncho) / 2;

                                if (der2 && rectX2 < canvas.width - rectAncho) {
                                    rectX2 += 7;
                                } else if (izq2 && rectX2 > 0) {
                                    rectX2 -= 7;
                                }
                                if (der2 && rectX2 < canvas.width - rectAncho) {
                                    rectX2 += 7;
                                } else if (izq2 && rectX2 > 0) {
                                    rectX2 -= 7;
                                }


                                document.location.reload();

                            }
                        }
                    }
                }

            }

        }

        //funcion la cual nos creara la bola
        function crearBall() {

            context.beginPath();
            context.arc(x, y, radioBall, 0, Math.PI * 2);
            context.fillStyle = "darkorange";
            context.fill();
            context.closePath();

            if (x + dx > canvas.width - radioBall || x + dx < radioBall) {
                dx = -dx;
            }
            if (y + dy < radioBall) {
                dy = -dy;
            }
        }

        function crearBall2() {

            context.beginPath();
            context.arc(x2, y2, radioBall, 0, Math.PI * 2);
            context.fillStyle = "black";
            context.fill();
            context.closePath();

            if (x2 + dx2 > canvas.width - radioBall || x2 + dx2 < radioBall) {
                dx2 = -dx2;
            }
            if (y2 + dy2 < radioBall) {
                dy2 = -dy2;
            }
        }
        //funcion la cual nos crea el rectangulo
        function crearRect() {
            context.beginPath();
            //Dibuja el rectangulo a lo largo del eje X
            context.rect(rectX, canvas.height - rectAlto, rectAncho, rectAlto);
            context.fillStyle = "orange";
            context.fill();
            context.closePath();
        }

        function crearRect2() {
            context.beginPath();
            //Dibuja el rectangulo a lo largo del eje X
            context.rect(rectX2, canvas.height - rectAlto, rectAncho, rectAlto);
            context.fillStyle = "black";
            context.fill();
            context.closePath();
        }

        //funcion la cual nos crea los ladrillos
        function crearLadrillos() {

            for (col = 0; col < ladrilloColumnas; col++) {
                for (fila = 0; fila < ladrilloFilas; fila++) {
                    if (ladrillos[col][fila].status == 1) {
                        var ladrilloX = (col * (ladrilloAncho + ladrilloPadding)) + entreLadrillosIzq;
                        var ladrilloY = (fila * (ladrilloAltura + ladrilloPadding)) + entreLadrillosTop;
                        ladrillos[col][fila].x = ladrilloX;
                        ladrillos[col][fila].y = ladrilloY;
                        context.beginPath();
                        context.rect(ladrilloX, ladrilloY, ladrilloAncho, ladrilloAltura);
                        context.fillStyle = "orange";
                        context.fill();
                        context.closePath();
                    }
                }
            }

        }


        //funcion la cual creara el juego y llama el resto de funciones
        function crear() {
            document.getElementById("menu").style.display = "none"
            document.getElementById("canvas").style.display = "";
            //Limpia
            context.clearRect(0, 0, canvas.width, canvas.height);

            crearBall();
            crearRect();
            if (jugador2 == true) {
                crearRect2();
                crearBall2();
                deteccionColisiones2();
                dibujVidas2();
                crearPuntuacion2();
            }
            crearLadrillos();
            deteccionColisiones();
            crearPuntuacion();
            dibujVidas();


            //Condicion la cual permite que la bola rebote al llegar a las paredes
            if (x + dx > canvas.width - radioBall || x + dx < radioBall) {
                dx = -dx;
            }

            if (y + dy < radioBall) {
                dy = -dy;
                //Condicion la cual hace que rebote en el rectangulo
                //Condicion la cual hace que si toca la parte inferior se acabe el juego
                // si toca el "suelo" pierde una vida
                // si llega a 0 pierde
            } else if (y + dy > canvas.height - (radioBall + (radioBall / 2))) {
                if (x > rectX && x < rectX + (rectAncho + (rectAncho / 10))) {
                    dy = -dy;
                } else {
                    vidas--;
                    if (!vidas) {
                        alert("GAME OVER Jugador1");
                        document.location.reload();
                        //Cuantas menos vidas tienes mas rapido va todo
                    } else if (vidas == 2) {
                        x = canvas.width / 3;
                        y = canvas.height - 50;
                        dx = 4;
                        dy = -5;
                        rectX = (canvas.width - rectAncho) / 2;

                        if (der && rectX < canvas.width - rectAncho) {
                            rectX += 9;
                        } else if (izq && rectX > 0) {
                            rectX -= 9;
                        }

                    } else if (vidas == 1) {
                        x = canvas.width / 3;
                        y = canvas.height - 50;
                        dx = 6;
                        dy = -7;
                        rectX = (canvas.width - rectAncho) / 2;

                        if (der && rectX < canvas.width - rectAncho) {
                            rectX += 13;
                        } else if (izq && rectX > 5) {
                            rectX -= 13;
                        }

                    }

                }
            }

            //Condicion la cual permite que la bola2 rebote al llegar a las paredes
            if (x2 + dx2 > canvas.width - radioBall || x2 + dx2 < radioBall) {
                dx2 = -dx2;
            }
            //Condicion la cual hace que rebote en el rectangulo2
            if (y2 + dy2 < radioBall) {
                dy2 = -dy2;

                //Condicion la cual hace que si toca la parte inferior se acabe el juego
                // si toca el "suelo" pierde una vida
                // si llega a 0 pierde
            } else if (y2 + dy2 > canvas.height - (radioBall + (radioBall / 2))) {
                if (x2 >= rectX2 && x2 <= rectX2 + (rectAncho + (rectAncho / 10))) {
                    dy2 = -dy2;
                } else {
                    vidas2--;
                    if (!vidas) {
                        alert("GAME OVER Jugador2");
                        document.getElementById("menu").style.display = ""
                        document.getElementById("canvas").style.display = "none";
                        document.location.reload();
                        //Cuantas menos vidas tienes mas rapido va todo
                    } else if (vidas2 == 2) {

                        x2 = canvas.width / 3;
                        y2 = canvas.height - 50;

                        dx2 = 4;
                        dy2 = -5;

                        rectX2 = (canvas.width - rectAncho) / 2;

                        if (der2 && rectX2 < canvas.width - rectAncho) {
                            rectX2 += 10;
                        } else if (izq2 && rectX2 > 0) {
                            rectX2 -= 10;
                        }

                    } else if (vidas2 == 1) {

                        x2 = canvas.width / 3;
                        y2 = canvas.height - 50;

                        dx2 = 9;
                        dy2 = -9;
                        rectX2 = (canvas.width - rectAncho) / 2;

                        if (der2 && rectX2 < canvas.width - rectAncho) {
                            rectX2 += 13;
                        } else if (izq2 && rectX2 > 0) {
                            rectX2 -= 13;
                        }

                    }

                }
            }

            //Condicion la cual mueve el rectangulo
            if (der && rectX < canvas.width - rectAncho) {
                rectX += 7;
            } else if (izq && rectX > 0) {
                rectX -= 7;
            }
            if (der2 && rectX2 < canvas.width - rectAncho) {
                rectX2 += 7;
            } else if (izq2 && rectX2 > 0) {
                rectX2 -= 7;
            }
            //Aplicamos la velocidad al movimiento de la pelota por lols ejes
            x += dx;
            y += dy;
            x2 += dx2;
            y2 += dy2;
            requestAnimationFrame(crear);
        }

        // Hace un intervalo de la funcion pasada por parametro a los milisegundos puestos
        // me repite la funcion infinitamente a la velocidad que le diga
    </script>

</body>

</html>